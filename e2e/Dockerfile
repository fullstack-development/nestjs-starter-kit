FROM node:16.17-alpine3.15

COPY . /stk
WORKDIR /stk

ENV API_ADDRESS=$API_ADDRESS
ENV API_PORT=$API_PORT
ENV WORKER_ADDRESS=$WORKER_ADDRESS
ENV WORKER_PORT=$WORKER_PORT
ENV MAX_TRIES=$MAX_TRIES

RUN chmod +x /stk/run.sh
RUN apk --no-cache add curl
RUN apk --no-cache add bash
RUN yarn

CMD [ "sh", "-c", "API_ADDRESS=$API_ADDRESS API_PORT=$API_PORT MAX_TRIES=$MAX_TRIES WORKER_ADDRESS=$WORKER_ADDRESS WORKER_PORT=$WORKER_PORT /stk/run.sh" ]
